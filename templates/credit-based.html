<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Responsive Credit Purchase Modal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .modal-content::-webkit-scrollbar {
            display: none;
        }

        .modal-content {
            -ms-overflow-style: none;
            /* IE 10+ */
            scrollbar-width: none;
            /* Firefox */
        }

        .pricing-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .credit-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .credit-label strong {
            font-size: 1rem;
        }

        .credit-meta {
            text-align: right;
        }

        .credit-meta small {
            display: block;
            color: #666;
            font-size: 0.85rem;
        }

        .credit-meta span {
            font-weight: 600;
            font-size: 1rem;
        }

        @media (max-width: 576px) {
            .modal-lg {
                max-width: 95%;
            }

            .pricing-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .credit-meta {
                text-align: left;
                margin-top: 5px;
            }
        }
    </style>
</head>

<body>

    <!-- Trigger Button -->
    <div class="container text-center mt-5">
        <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#purchaseModal">
            Purchase Credits
        </button>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="purchaseModal" tabindex="-1" aria-labelledby="purchaseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="purchaseModalLabel">Select Your Credit Plan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form id="paymentForm" style="overflow-y: scroll;">
                    <div class="modal-body">
                        <div class="mb-4">
                            <div class="pricing-row">
                                <div class="credit-label">
                                    <input class="form-check-input" type="radio" name="credits" id="c50" value="50">
                                    <label for="c50"><strong>50 credits</strong> <small class="text-muted">/
                                            lifetime</small></label>
                                </div>
                                <div class="credit-meta">
                                    <small>₹50 per credit</small>
                                    <span>₹2500</span>
                                </div>
                            </div>

                            <div class="pricing-row">
                                <div class="credit-label">
                                    <input class="form-check-input" type="radio" name="credits" id="c100" value="100">
                                    <label for="c100"><strong>100 credits</strong> <small class="text-muted">/
                                            lifetime</small></label>
                                </div>
                                <div class="credit-meta">
                                    <small>₹45 per credit</small>
                                    <span>₹4500</span>
                                </div>
                            </div>

                            <div class="pricing-row">
                                <div class="credit-label">
                                    <input class="form-check-input" type="radio" name="credits" id="c500" value="500">
                                    <label for="c500"><strong>500 credits</strong> <small class="text-muted">/ lifetime</small></label>
                                </div>
                                <div class="credit-meta">
                                    <small>₹40 per credit</small>
                                    <span>₹20000</span>
                                </div>
                            </div>

                            <div class="pricing-row">
                                <div class="credit-label">
                                    <input class="form-check-input" type="radio" name="credits" id="c1000" value="1000">
                                    <label for="c1000"><strong>1000 credits</strong> <small class="text-muted">/ lifetime</small></label>
                                </div>
                                <div class="credit-meta">
                                    <small>₹35 per credit</small>
                                    <span>₹35000</span>
                                </div>
                            </div>
                            <div class="pricing-row">
                                <div class="credit-label">
                                    <input class="form-check-input" type="radio" name="credits" id="c2500" value="2500">
                                    <label for="c2500"><strong>2500 credits</strong> <small class="text-muted">/ lifetime</small></label>
                                </div>
                                <div class="credit-meta">
                                    <small>₹25 per credit</small>
                                    <span>₹62500</span>
                                </div>
                            </div>
                            <div class="pricing-row">
                                <div class="credit-label">
                                    <input class="form-check-input" type="radio" name="credits" id="c5000" value="5000">
                                    <label for="c5000"><strong>5000 credits</strong> <small class="text-muted">/ lifetime</small></label>
                                </div>
                                <div class="credit-meta">
                                    <small>₹20 per credit</small>
                                    <span>₹100000</span>
                                </div>
                            </div>
                        </div>

                        <hr>
                        <!-- Coupon Code -->
                        <div class="mb-3">
                            <h6 class="mb-3">Apply Coupon Code</h6>
                            <div class="input-group">
                                <input type="text" class="form-control" id="coupon" placeholder="Enter coupon code">
                                <button class="btn btn-primary" type="button" onclick="applyCoupon()">Apply</button>
                            </div>
                            <div id="couponMessage" class="form-text text-success mt-1"></div>
                        </div>

                        <!-- Payment Form -->
                        <h6 class="mb-3">Payment Details</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="amount" class="form-label">Amount (₹)</label>
                                <input type="text" class="form-control" id="amount" name="amount" readonly
                                    placeholder="Auto-filled">
                            </div>
                            <div class="col-md-6">
                                <label for="name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="name" name="name" placeholder="John Doe">
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" name="email"
                                    placeholder="john@example.com">
                            </div>
                            <div class="col-md-6">
                                <label for="contact" class="form-label">Contact</label>
                                <input type="text" class="form-control" id="contact" name="contact"
                                    placeholder="9999999999">
                            </div>
                        </div>

                    </div>

                    <div class="modal-footer" style="margin-bottom: 30px;">
                        <button type="submit" class="btn btn-success w-100">Pay Now</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const creditPricing = {
            50: 2500,
            100: 4500,
            500: 20000,
            1000: 35000,
            2500: 62500,
            5000: 100000
        };

        let selectedCredits = null;
        let appliedDiscount = 0;

        // Plan selection handler
        document.querySelectorAll('input[name="credits"]').forEach(radio => {
            radio.addEventListener('change', () => {
                selectedCredits = radio.value;
                appliedDiscount = 0;
                document.getElementById("couponMessage").textContent = "";
                updateAmount();
            });
        });

        function updateAmount() {
            if (!selectedCredits) return;
            const base = creditPricing[selectedCredits];
            var discounted = 0
            if (appliedDiscount!==0) {
                console.log("apply disount");
                var discounted = appliedDiscount ? base - (base * appliedDiscount / 100) : base;
            } else {
                var discounted = base;
                console.log(discounted);
                
            }
            // const discounted = appliedDiscount ? base - (base * appliedDiscount / 100) : base;
            document.getElementById("amount").value = Math.round(discounted);
        }

        function applyCoupon() {
            const code = document.getElementById("coupon").value.trim();
            if (!code || !selectedCredits) {
                alert("Select a plan and enter a coupon code.");
                return;
            }

            fetch(`/api/check-coupon?code=${code}`)
                .then(res => res.json())
                .then(data => {
                    if (data.valid) {
                        appliedDiscount = data.discount
                        console.log(appliedDiscount);
                        updateAmount();
                        document.getElementById("couponMessage").textContent = `✅ ${appliedDiscount}% discount applied!`;
                    } else {
                        appliedDiscount = 0;
                        updateAmount();
                        document.getElementById("couponMessage").textContent = `❌ Invalid coupon code.`;
                    }
                })
                .catch(() => {
                    document.getElementById("couponMessage").textContent = "Error checking coupon.";
                });
        }
    </script>
</body>

</html>